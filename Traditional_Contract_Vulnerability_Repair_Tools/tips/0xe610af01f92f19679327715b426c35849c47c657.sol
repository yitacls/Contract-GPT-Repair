pragma solidity ^0.4.19;
contract PIGGY_BANK {
	mapping(address => uint) public Accounts;
	uint public MinSum = 1 ether;
	Log LogFile;
	uint putBlock;
	constructor(address _log) public {
	LogFile = Log(_log);
	}
	function Put(address to) payable public {
	Accounts[to] += msg.value;
	LogFile.AddMessage(msg.sender, msg.value, "Put");
	putBlock = block.number;
	}
	function Collect(uint _am) payable public {
	if(Accounts[msg.sender] >= MinSum && _am <= Accounts[msg.sender] && block.number > putBlock){
	if(msg.sender.send(_am)){
	Accounts[msg.sender] -= _am;
	LogFile.AddMessage(msg.sender, _am, "Collect");
	}
	else{
	throw;}
	}
	}
	function () payable public {
	Put(msg.sender);
	}
	
}contract Log {
	struct Message{
	address Sender;
	string Data;
	uint Val;
	uint Time;
	}
	Message[] public History;
	Message LastMsg;
	function AddMessage(address _adr, uint _val, string _data) public {
	LastMsg.Sender = _adr;
	LastMsg.Time = now;
	LastMsg.Val = _val;
	LastMsg.Data = _data;
	History.push(LastMsg);
	}
	
}