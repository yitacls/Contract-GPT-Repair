pragma solidity ^0.4.25;
contract SYC2ndEarlyPurchase {
	string public constant PURCHASE_AMOUNT_UNIT = "ETH";
	uint public constant WEI_MINIMUM_PURCHASE = 10 * 10 ** 18;
	uint public constant WEI_MAXIMUM_EARLYPURCHASE = 7000 * 10 ** 18;
	uint public constant STARTING_TIME = 1504526400;
	uint public constant ENDING_TIME = 1504785599;
	address public owner;
	EarlyPurchase[] public earlyPurchases;
	uint public earlyPurchaseClosedAt;
	uint public totalEarlyPurchaseRaised;
	address public sycCrowdsale;
	struct EarlyPurchase{
	address purchaser;
	uint amount;
	uint purchasedAt;
	}
	modifier onlyOwner(){
	if(msg.sender != owner){
	throw;}
	_;}
	modifier onlyEarlyPurchaseTerm(){
	if(earlyPurchaseClosedAt > 0 || now < STARTING_TIME || now > ENDING_TIME){
	throw;}
	_;}
	constructor() public {
	owner = msg.sender;
	}
	function purchasedAmountBy(address purchaser) view external returns(uint amount){
	for(uint i;i < earlyPurchases.length;i++){
	if(earlyPurchases[i].purchaser == purchaser){
	amount += earlyPurchases[i].amount;
	}
	}
	}
	function setup(address _sycCrowdsale) onlyOwner external returns(bool ){
	if(address(_sycCrowdsale) == 0){
	sycCrowdsale = _sycCrowdsale;
	return true;
	}
	return false;
	}
	function numberOfEarlyPurchases() view external returns(uint ){
	return earlyPurchases.length;
	}
	function appendEarlyPurchase(address purchaser, uint amount, uint purchasedAt) onlyEarlyPurchaseTerm internal returns(bool ){
	if(purchasedAt == 0 || purchasedAt > now){
	throw;}
	if(totalEarlyPurchaseRaised + amount >= WEI_MAXIMUM_EARLYPURCHASE){
	if(! purchaser.send(totalEarlyPurchaseRaised + amount - WEI_MAXIMUM_EARLYPURCHASE)){
	throw;}
	earlyPurchases.push(EarlyPurchase(purchaser, WEI_MAXIMUM_EARLYPURCHASE - totalEarlyPurchaseRaised, purchasedAt));
	totalEarlyPurchaseRaised += WEI_MAXIMUM_EARLYPURCHASE - totalEarlyPurchaseRaised;
	}
	else{
	earlyPurchases.push(EarlyPurchase(purchaser, amount, purchasedAt));
	totalEarlyPurchaseRaised += amount;
	}
	if(totalEarlyPurchaseRaised >= WEI_MAXIMUM_EARLYPURCHASE || now >= ENDING_TIME){
	earlyPurchaseClosedAt = now;
	}
	return true;
	}
	function closeEarlyPurchase() onlyOwner public returns(bool ){
	earlyPurchaseClosedAt = now;
	}
	function withdraw(uint withdrawalAmount) onlyOwner public {
	if(! owner.send(withdrawalAmount)){
	throw;}
	}
	function withdrawAll() onlyOwner public {
	if(! owner.send(this.balance)){
	throw;}
	}
	function transferOwnership(address newOwner) onlyOwner public {
	owner = newOwner;
	}
	function () payable public {
	require(msg.value >= WEI_MINIMUM_PURCHASE);
	appendEarlyPurchase(msg.sender, msg.value, now);
	}
	
}